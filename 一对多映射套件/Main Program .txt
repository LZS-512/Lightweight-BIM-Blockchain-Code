package main

import (
	"fmt"
	"mapping-toolkit/ipfs"
	"mapping-toolkit/user"
	"mapping-toolkit/transaction"
	"mapping-toolkit/mapper"
)

func main() {
	// 1. 初始化信息处理：上传 BIM 文件到 IPFS
	ipfsClient := ipfs.NewIPFSClient("localhost:5001")
	cid, err := ipfsClient.UploadBIMFile("sample.bim")
	if err != nil {
		panic(err)
	}
	fmt.Println("BIM File CID:", cid)

	// 2. 获取用户信息
	u, err := user.GetUserInfo("A00123")
	if err != nil {
		panic(err)
	}
	fmt.Println("User Info:", u)

	// 3. 交易封装
	tx, err := transaction.BuildTransaction(cid, u)
	if err != nil {
		panic(err)
	}
	fmt.Println("Transaction Data:", string(tx))

	// 4. 映射到区块链节点
	node, err := mapper.MapUserToNode(u.Dept)
	if err != nil {
		panic(err)
	}
	fmt.Println("Mapped Blockchain Node:", node)

	// 这里可继续调用 Fabric SDK 执行链码
}
