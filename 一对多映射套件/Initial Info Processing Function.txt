package ipfs

import (
	"bytes"
	"fmt"
	shell "github.com/ipfs/go-ipfs-api"
	"os"
)

type IPFSClient struct {
	sh *shell.Shell
}

// 初始化 IPFS 客户端
func NewIPFSClient(url string) *IPFSClient {
	return &IPFSClient{
		sh: shell.NewShell(url),
	}
}

// 上传 BIM 文件到 IPFS，返回 CID
func (c *IPFSClient) UploadBIMFile(path string) (string, error) {
	file, err := os.ReadFile(path)
	if err != nil {
		return "", fmt.Errorf("read BIM file failed: %v", err)
	}

	cid, err := c.sh.Add(bytes.NewBuffer(file))
	if err != nil {
		return "", fmt.Errorf("IPFS add failed: %v", err)
	}

	return cid, nil
}
